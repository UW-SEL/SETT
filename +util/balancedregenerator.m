function [eff] = balancedregenerator(NTU,U)
    % balancedregenerator - provides the effectiveness of a balanced
    % regenerator (i.e., the capacitance rate is the same during both the hot and cold blow processes)
    % as a function of the number of transfer units and utilization
    %
    % Necessary inputs are:
    % NTU = h*A_s/(C_dot) where 
        % h is heat transfer coefficient, 
        % A_s is surface area
        % C_dot is capacitance rate of fluid during flow process
    % U = C_dot*t/C_m where
        % t is time for one blow process
        % C_m capacitance of the matrix
        
    if (U>1)
       call warning("U must be < 1 in balancedregenerator");
    end
    %Spline interpolation to find Deff as a function of U and NTU
    log10NTU=log10(NTU);
    Deffm=[0,0,0,0,0,0,0,0,0,0,0;0,9.99999999999890e-05,0.000400000000000011,0.00100000000000000,0.00179999999999997,0.00289999999999996,0.00409999999999999,0.00559999999999999,0.00729999999999997,0.00919999999999999,0.0112000000000000;0,0.000299999999999967,0.00100000000000000,0.00219999999999998,0.00379999999999997,0.00589999999999996,0.00839999999999996,0.0113000000000000,0.0147000000000000,0.0184000000000000,0.0225000000000000;0,0.000400000000000011,0.00140000000000001,0.00319999999999998,0.00569999999999998,0.00879999999999998,0.0126000000000000,0.0170000000000000,0.0220000000000000,0.0272000000000000,0.0335000000000000;0,0.000499999999999945,0.00190000000000001,0.00429999999999997,0.00749999999999995,0.0115999999999999,0.0165000000000000,0.0223000000000000,0.0286999999999999,0.0358999999999999,0.0436000000000000;0,0.000599999999999934,0.00229999999999997,0.00509999999999999,0.00900000000000001,0.0139000000000000,0.0197999999999999,0.0266999999999999,0.0344000000000000,0.0429999999999999,0.0523000000000000;0,0.000699999999999923,0.00259999999999994,0.00590000000000002,0.0103000000000000,0.0160000000000000,0.0226999999999999,0.0306000000000000,0.0394000000000000,0.0490999999999999,0.0598000000000000;0,0.000799999999999912,0.00290000000000001,0.00649999999999995,0.0114000000000000,0.0176000000000000,0.0251000000000000,0.0337000000000000,0.0435000000000000,0.0542999999999999,0.0660000000000000;0,0.000800000000000023,0.00309999999999999,0.00700000000000001,0.0123000000000000,0.0190000000000000,0.0271000000000000,0.0364000000000000,0.0469000000000001,0.0586000000000000,0.0713000000000000;0,0.000900000000000012,0.00340000000000007,0.00750000000000006,0.0131000000000000,0.0202000000000000,0.0287000000000001,0.0386000000000001,0.0498000000000001,0.0622000000000000,0.0758000000000001;0,0.000899999999999901,0.00349999999999995,0.00779999999999992,0.0136999999999999,0.0210999999999999,0.0299999999999999,0.0404000000000000,0.0520999999999999,0.0651999999999999,0.0794999999999999;0,0.000900000000000012,0.00370000000000004,0.00819999999999999,0.0143000000000000,0.0220000000000000,0.0312000000000000,0.0419000000000001,0.0541000000000000,0.0677000000000000,0.0828000000000000;0,0.00100000000000000,0.00400000000000000,0.00870000000000004,0.0152000000000001,0.0232000000000000,0.0329000000000000,0.0441000000000000,0.0570000000000001,0.0716000000000000,0.0878000000000001;0,0.00109999999999999,0.00409999999999999,0.00910000000000000,0.0157000000000000,0.0240000000000000,0.0339000000000000,0.0455000000000001,0.0590000000000001,0.0743000000000000,0.0914000000000000;0,0.00109999999999999,0.00430000000000008,0.00940000000000008,0.0161000000000000,0.0245000000000001,0.0346000000000001,0.0464000000000000,0.0602000000000000,0.0761000000000001,0.0940000000000001;0,0.00109999999999999,0.00440000000000007,0.00950000000000006,0.0163000000000001,0.0247000000000001,0.0349000000000000,0.0469000000000001,0.0609000000000001,0.0772000000000001,0.0958000000000000;0,0.00119999999999998,0.00459999999999994,0.00969999999999993,0.0165000000000000,0.0248999999999999,0.0350999999999999,0.0470999999999999,0.0613999999999999,0.0780000000000000,0.0971000000000000;0,0.00119999999999998,0.00449999999999995,0.00969999999999993,0.0165000000000000,0.0247999999999999,0.0349999999999999,0.0469999999999999,0.0614000000000000,0.0782999999999999,0.0979000000000000;0,0.00119999999999998,0.00470000000000004,0.00980000000000003,0.0165000000000000,0.0247000000000001,0.0346000000000000,0.0466000000000000,0.0611000000000000,0.0784000000000000,0.0988000000000000;0,0.00130000000000008,0.00470000000000004,0.00980000000000003,0.0163000000000000,0.0241000000000000,0.0340000000000000,0.0459000000000001,0.0603000000000000,0.0779000000000000,0.0988000000000000;0,0.00129999999999997,0.00470000000000004,0.00960000000000005,0.0159000000000000,0.0232000000000000,0.0332000000000000,0.0449000000000001,0.0593000000000000,0.0769000000000000,0.0984000000000000;0,0.00129999999999997,0.00470000000000004,0.00950000000000006,0.0156000000000001,0.0222000000000000,0.0324000000000000,0.0438000000000001,0.0581000000000000,0.0758000000000000,0.0977000000000000;0,0.00129999999999997,0.00460000000000005,0.00929999999999998,0.0152000000000000,0.0224000000000000,0.0314000000000000,0.0425000000000000,0.0566000000000000,0.0743000000000000,0.0966000000000000;0,0.00129999999999997,0.00449999999999995,0.00899999999999990,0.0146999999999999,0.0216999999999999,0.0303000000000000,0.0410999999999999,0.0549000000000000,0.0727000000000000,0.0952000000000000;0,0.00129999999999997,0.00429999999999997,0.00849999999999995,0.0138000000000000,0.0203000000000000,0.0284000000000000,0.0386000000000000,0.0518999999999999,0.0695000000000000,0.0925000000000000;0,0.00119999999999998,0.00409999999999999,0.00800000000000001,0.0128999999999999,0.0190000000000000,0.0266000000000000,0.0363000000000000,0.0490999999999999,0.0664000000000000,0.0897000000000000;0,0.00130000000000008,0.00400000000000000,0.00770000000000004,0.0122000000000000,0.0176000000000001,0.0246000000000001,0.0343000000000000,0.0466000000000000,0.0636000000000000,0.0871000000000001;0,0.00119999999999998,0.00360000000000005,0.00690000000000002,0.0109000000000000,0.0159000000000000,0.0224000000000000,0.0308000000000001,0.0422000000000000,0.0586000000000000,0.0823000000000000;0,0.00109999999999999,0.00329999999999997,0.00629999999999997,0.00990000000000002,0.0144000000000000,0.0203000000000000,0.0280000000000000,0.0387000000000000,0.0544000000000000,0.0782000000000001;0,0.00100000000000000,0.00290000000000001,0.00540000000000007,0.00829999999999997,0.0122000000000000,0.0172000000000000,0.0238000000000000,0.0333000000000000,0.0479000000000001,0.0715000000000000;0,0.00100000000000000,0.00250000000000006,0.00470000000000004,0.00730000000000008,0.0106000000000001,0.0150000000000000,0.0208000000000000,0.0294000000000001,0.0430000000000000,0.0663000000000000;0,0.000700000000000034,0.00200000000000000,0.00370000000000004,0.00550000000000006,0.00800000000000001,0.0114000000000000,0.0159000000000000,0.0230000000000000,0.0346000000000000,0.0571000000000000;0,0.000700000000000034,0.00170000000000003,0.00309999999999999,0.00449999999999995,0.00659999999999994,0.00929999999999998,0.0131000000000000,0.0193000000000000,0.0294000000000000,0.0511000000000000;0,0.000499999999999945,0.00129999999999997,0.00229999999999997,0.00339999999999996,0.00500000000000000,0.00689999999999991,0.00979999999999992,0.0148999999999999,0.0229999999999999,0.0434000000000000;0,0.000300000000000078,0.000900000000000012,0.00140000000000007,0.00200000000000000,0.00300000000000000,0.00409999999999999,0.00600000000000001,0.00970000000000004,0.0146000000000001,0.0324000000000000;0,0.000199999999999978,0.000600000000000045,0.000900000000000012,0.00129999999999997,0.00209999999999999,0.00270000000000004,0.00429999999999997,0.00719999999999998,0.0104000000000000,0.0260000000000000];
    Um=[0;0.100000000000000;0.200000000000000;0.300000000000000;0.400000000000000;0.500000000000000;0.600000000000000;0.700000000000000;0.800000000000000;0.900000000000000;1];
    log10NTUm=[-1;0;0.176091259055681;0.301029995663981;0.397940008672038;0.477121254719662;0.544068044350276;0.602059991327962;0.653212513775344;0.698970004336019;0.740362689494244;0.778151250383644;0.845098040014257;0.903089986991944;0.954242509439325;1;1.04139268515823;1.07918124604762;1.14612803567824;1.20411998265592;1.25527250510331;1.30102999566398;1.35218251811136;1.39794000867204;1.47712125471966;1.54406804435028;1.60205999132796;1.69897000433602;1.77815125038364;1.90308998699194;2;2.17609125905568;2.30102999566398;2.47712125471966;2.77815125038364;3];
    Deff=interp2(Um,log10NTUm,Deffm,U,log10NTU,'spline');  %efficiency reduction relative to balanced counterflow heat exchanger
    eff=(NTU/2)/(1+NTU/2)-Deff;  %effectiveness
    
end